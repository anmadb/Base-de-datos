CONSULTAS MULTITABLA (COMPOSICION INTERNA)

-- 	1.4.5

-- 1. Obtén un listado con el nombre de cada cliente y el nombre y apellido de su representante de ventas.

SELECT C.NOMBRE_CLIENTE, CONCAT(E.NOMBRE," ",E.APELLIDO1," ",E.APELLIDO2)NOMBRE
FROM CLIENTE C, EMPLEADO E
WHERE E.CODIGO_EMPLEADO = C.CODIGO_EMPLEADO_REP_VENTAS

SELECT C.NOMBRE_CLIENTE, CONCAT(E.NOMBRE," ",E.APELLIDO1," ",E.APELLIDO2)NOMBRE
FROM CLIENTE C INNER JOIN EMPLEADO E 
ON E.CODIGO_EMPLEADO = C.CODIGO_EMPLEADO_REP_VENTAS


-- 2. Muestra el nombre de los clientes que hayan realizado pagos junto con el nombre de sus representantes de ventas.

SELECT C.NOMBRE_CLIENTE, CONCAT(E.NOMBRE," ",E.APELLIDO1," ",E.APELLIDO2)NOMBRE
FROM CLIENTE C, EMPLEADO E, PAGO P
WHERE E.CODIGO_EMPLEADO = C.CODIGO_EMPLEADO_REP_VENTAS 
AND C.CODIGO_CLIENTE = P.CODIGO_CLIENTE

SELECT C.NOMBRE_CLIENTE, CONCAT(E.NOMBRE," ",E.APELLIDO1," ",E.APELLIDO2)NOMBRE
FROM CLIENTE C INNER JOIN EMPLEADO E 
ON E.CODIGO_EMPLEADO = C.CODIGO_EMPLEADO_REP_VENTAS
INNER JOIN PAGO P ON C.CODIGO_CLIENTE = P.CODIGO_CLIENTE


-- 3. Muestra el nombre de los clientes que NO hayan realizado pagos junto con el nombre de sus representantes de ventas.

SELECT DISTINCT C.CODIGO_CLIENTE, C.NOMBRE_CLIENTE, CONCAT(E.NOMBRE," ",E.APELLIDO1," ",E.APELLIDO2)NOMBRE
FROM CLIENTE C, EMPLEADO E, PAGO P 
WHERE E.CODIGO_EMPLEADO = C.CODIGO_EMPLEADO_REP_VENTAS 
AND C.CODIGO_CLIENTE NOT IN 
(SELECT DISTINCT C.CODIGO_CLIENTE
FROM CLIENTE C, EMPLEADO E, PAGO P 
WHERE E.CODIGO_EMPLEADO = C.CODIGO_EMPLEADO_REP_VENTAS
AND C.CODIGO_CLIENTE = P.CODIGO_CLIENTE
ORDER BY C.CODIGO_CLIENTE)

SELECT DISTINCT C.CODIGO_CLIENTE, C.NOMBRE_CLIENTE, CONCAT(E.NOMBRE," ",E.APELLIDO1," ",E.APELLIDO2)NOMBRE
FROM CLIENTE C INNER JOIN EMPLEADO E 
ON E.CODIGO_EMPLEADO = C.CODIGO_EMPLEADO_REP_VENTAS
AND C.CODIGO_CLIENTE NOT IN 
(SELECT DISTINCT C.CODIGO_CLIENTE
FROM CLIENTE C, EMPLEADO E, PAGO P 
WHERE E.CODIGO_EMPLEADO = C.CODIGO_EMPLEADO_REP_VENTAS
AND C.CODIGO_CLIENTE = P.CODIGO_CLIENTE
ORDER BY C.CODIGO_CLIENTE)


-- 4. Devuelve el nombre de los clientes que han hecho pagos y el nombre de sus representantes junto con la ciudad de la oficina a la que pertenece el representante.

SELECT DISTINCT C.NOMBRE_CLIENTE, CONCAT(E.NOMBRE," ",E.APELLIDO1," ",E.APELLIDO2)NOMBRE, O.CIUDAD
FROM CLIENTE C, EMPLEADO E, PAGO P, OFICINA O
WHERE E.CODIGO_EMPLEADO = C.CODIGO_EMPLEADO_REP_VENTAS 
AND C.CODIGO_CLIENTE = P.CODIGO_CLIENTE
AND O.CODIGO_OFICINA = E.CODIGO_OFICINA

SELECT DISTINCT C.NOMBRE_CLIENTE, CONCAT(E.NOMBRE," ",E.APELLIDO1," ",E.APELLIDO2)NOMBRE, O.CIUDAD
FROM CLIENTE C INNER JOIN EMPLEADO E 
ON E.CODIGO_EMPLEADO = C.CODIGO_EMPLEADO_REP_VENTAS
INNER JOIN PAGO P ON C.CODIGO_CLIENTE = P.CODIGO_CLIENTE
INNER JOIN OFICINA O ON O.CODIGO_OFICINA = E.CODIGO_OFICINA


-- 5. Devuelve el nombre de los clientes que no hayan hecho pagos y el nombre de sus representantes junto con la ciudad de la oficina a la que pertenece el representante.

SELECT DISTINCT C.NOMBRE_CLIENTE, CONCAT(E.NOMBRE," ",E.APELLIDO1," ",E.APELLIDO2)NOMBRE, O.CIUDAD
FROM CLIENTE C, EMPLEADO E, PAGO P, OFICINA O
WHERE E.CODIGO_EMPLEADO = C.CODIGO_EMPLEADO_REP_VENTAS 
AND C.CODIGO_CLIENTE NOT IN
(SELECT DISTINCT CODIGO_CLIENTE
FROM PAGO )
AND O.CODIGO_OFICINA = E.CODIGO_OFICINA


-- 6. Lista la dirección de las oficinas que tengan clientes en Fuenlabrada.

SELECT O.CODIGO_OFICINA, O.LINEA_DIRECCION1, C.CIUDAD
FROM OFICINA O, CLIENTE C, EMPLEADO E
WHERE E.CODIGO_EMPLEADO = C.CODIGO_EMPLEADO_REP_VENTAS
AND E.CODIGO_OFICINA = O.CODIGO_OFICINA 
AND C.CIUDAD LIKE "%Fuenlabrada%"


-- 7. Devuelve el nombre de los clientes y el nombre de sus representantes junto con la ciudad de la oficina a la que pertenece el representante.

SELECT C.NOMBRE_CLIENTE, CONCAT(E.NOMBRE," ",E.APELLIDO1," ",E.APELLIDO2)NOMBRE, O.CIUDAD
FROM CLIENTE C, OFICINA O, EMPLEADO E
WHERE E.CODIGO_EMPLEADO = C.CODIGO_EMPLEADO_REP_VENTAS
AND E.CODIGO_OFICINA = O.CODIGO_OFICINA


-- 8. Devuelve un listado con el nombre de los empleados junto con el nombre de sus jefes.

SELECT A.CODIGO_EMPLEADO, CONCAT(A.NOMBRE," ",A.APELLIDO1," ",A.APELLIDO2)NOMBRE,
CONCAT(B.NOMBRE," ",B.APELLIDO1," ",B.APELLIDO2)NOMBRE
FROM EMPLEADO A, EMPLEADO B
WHERE A.CODIGO_JEFE = B.CODIGO_EMPLEADO
ORDER BY 1


-- 9. Devuelve un listado que muestre el nombre de cada empleados, el nombre de su jefe y el nombre del jefe de sus jefe.

SELECT A.CODIGO_EMPLEADO, CONCAT(A.NOMBRE," ",A.APELLIDO1," ",A.APELLIDO2)NOMBRE,
CONCAT(B.NOMBRE," ",B.APELLIDO1," ",B.APELLIDO2)NOMBRE,
CONCAT(C.NOMBRE," ",C.APELLIDO1," ",C.APELLIDO2)NOMBRE
FROM EMPLEADO A, EMPLEADO B, EMPLEADO C
WHERE A.CODIGO_JEFE = B.CODIGO_EMPLEADO 
AND B.CODIGO_JEFE = C.CODIGO_EMPLEADO
ORDER BY 1


-- 10. Devuelve el nombre de los clientes a los que no se les ha entregado a tiempo un pedido.

SELECT DISTINCT C.NOMBRE_CLIENTE
FROM PEDIDO P, CLIENTE C
WHERE C.CODIGO_CLIENTE = P.CODIGO_CLIENTE
AND FECHA_ENTREGA > FECHA_ESPERADA


-- 11. Devuelve un listado de las diferentes gamas de producto que ha comprado cada cliente.

SELECT DISTINCT C.NOMBRE_CLIENTE, G.GAMA
FROM GAMA_PRODUCTO G, PRODUCTO P, DETALLE_PEDIDO DP, PEDIDO PE, CLIENTE C
WHERE G.GAMA = P.GAMA
AND P.CODIGO_PRODUCTO = DP.CODIGO_PRODUCTO
AND DP.CODIGO_PEDIDO = PE.CODIGO_PEDIDO
AND PE.CODIGO_CLIENTE = C.CODIGO_CLIENTE
ORDER BY 1,2

_________________________________________________________________________________________________________________________________________



CONSULTAS MULTITABLA (COMPOSICION EXTERNA)

-- 1. Devuelve un listado que muestre solamente los clientes que no han realizado ningún pago.

SELECT C.NOMBRE_CLIENTE
FROM CLIENTE C
LEFT JOIN PAGO P ON C.CODIGO_CLIENTE = P.CODIGO_CLIENTE
WHERE P.CODIGO_CLIENTE IS NULL


-- 2. Devuelve un listado que muestre solamente los clientes que no han realizado ningún pedido.

SELECT C.NOMBRE_CLIENTE
FROM CLIENTE C
LEFT JOIN PEDIDO P ON C.CODIGO_CLIENTE = P.CODIGO_CLIENTE
WHERE P.CODIGO_CLIENTE IS NULL


-- 3. Devuelve un listado que muestre los clientes que no han realizado ningún pago y los que no han realizado ningún pedido.

SELECT C.NOMBRE_CLIENTE
FROM CLIENTE C
LEFT JOIN PAGO PA ON C.CODIGO_CLIENTE = PA.CODIGO_CLIENTE
LEFT JOIN PEDIDO PE ON C.CODIGO_CLIENTE = PE.CODIGO_CLIENTE
WHERE PA.CODIGO_CLIENTE IS NULL AND PE.CODIGO_CLIENTE IS NULL 


-- 4. Devuelve un listado que muestre solamente los empleados que no tienen una oficina asociada.

SELECT E.CODIGO_EMPLEADO, CONCAT(E.NOMBRE," ",E.APELLIDO1," ",E.APELLIDO2)NOMBRE
FROM EMPLEADO E
LEFT JOIN OFICINA O ON E.CODIGO_OFICINA = O.CODIGO_OFICINA
WHERE E.CODIGO_OFICINA IS NULL


-- 5. Devuelve un listado que muestre solamente los empleados que no tienen un cliente asociado.

SELECT E.CODIGO_EMPLEADO, CONCAT(E.NOMBRE," ",E.APELLIDO1," ",E.APELLIDO2)NOMBRE
FROM EMPLEADO E
WHERE CODIGO_EMPLEADO NOT IN
(SELECT DISTINCT CODIGO_EMPLEADO_REP_VENTAS 
FROM CLIENTE)


-- 6. Devuelve un listado que muestre solamente los empleados que no tienen un cliente asociado junto con los datos de la oficina donde trabajan.

SELECT E.CODIGO_EMPLEADO, CONCAT(E.NOMBRE," ",E.APELLIDO1," ",E.APELLIDO2)NOMBRE, O.*
FROM EMPLEADO E, OFICINA O
WHERE E.CODIGO_EMPLEADO NOT IN
(SELECT DISTINCT CODIGO_EMPLEADO_REP_VENTAS 
FROM CLIENTE)
AND E.CODIGO_OFICINA = O.CODIGO_OFICINA


-- 7. Devuelve un listado que muestre los empleados que no tienen una oficina asociada y los que no tienen un cliente asociado.

SELECT E.CODIGO_EMPLEADO, CONCAT(E.NOMBRE," ",E.APELLIDO1," ",E.APELLIDO2)NOMBRE
FROM EMPLEADO E
WHERE E.CODIGO_EMPLEADO NOT IN
(SELECT DISTINCT CODIGO_EMPLEADO_REP_VENTAS 
FROM CLIENTE)
AND E.CODIGO_OFICINA NOT IN
(SELECT DISTINCT CODIGO_OFICINA
FROM EMPLEADO)


-- 8. Devuelve un listado de los productos que nunca han aparecido en un pedido.

SELECT CODIGO_PRODUCTO, NOMBRE
FROM PRODUCTO
WHERE CODIGO_PRODUCTO NOT IN
(SELECT DISTINCT CODIGO_PRODUCTO
FROM DETALLE_PEDIDO)
ORDER BY 1


-- 9. Devuelve un listado de los productos que nunca han aparecido en un pedido. El resultado debe mostrar el nombre y la descripción.

SELECT P.NOMBRE NOMBRE_PRODUCTO, P.DESCRIPCION DESCRIPCION_PRODUCTO
FROM PRODUCTO P
LEFT JOIN DETALLE_PEDIDO DP ON P.CODIGO_PRODUCTO = DP.CODIGO_PRODUCTO
WHERE DP.CODIGO_PRODUCTO IS NULL


-- 10. Devuelve las oficinas donde no trabajan ninguno de los empleados que hayan sido los representantes de ventas de algún cliente que haya realizado la compra de algún producto de la gama Frutales.

SELECT *
FROM OFICINA O
WHERE O.CODIGO_OFICINA NOT IN 
(SELECT DISTINCT E.CODIGO_OFICINA
FROM EMPLEADO E
JOIN CLIENTE C ON E.CODIGO_EMPLEADO = C.CODIGO_EMPLEADO_REP_VENTAS
JOIN PEDIDO PE ON C.CODIGO_CLIENTE = PE.CODIGO_CLIENTE
JOIN DETALLE_PEDIDO DP ON PE.CODIGO_PEDIDO = DP.CODIGO_PEDIDO
JOIN PRODUCTO PR ON DP.CODIGO_PRODUCTO = PR.CODIGO_PRODUCTO
JOIN GAMA_PRODUCTO GP ON PR.GAMA = GP.GAMA
WHERE GP.GAMA = 'FRUTALES')


-- 11. Devuelve un listado con los clientes que han realizado algún pedido pero no han realizado ningún pago.

SELECT DISTINCT C.*
FROM CLIENTE C, PEDIDO P, PAGO PA
WHERE C.CODIGO_CLIENTE = P.CODIGO_CLIENTE
AND C.CODIGO_CLIENTE NOT IN 
(SELECT DISTINCT CODIGO_CLIENTE
FROM PAGO)


-- 12. Devuelve un listado con los datos de los empleados que no tienen clientes asociados y el nombre de su jefe asociado.

SELECT DISTINCT E.CODIGO_EMPLEADO, CONCAT(E.NOMBRE," ",E.APELLIDO1," ",E.APELLIDO2)NOMBRE,
CONCAT(J.NOMBRE," ",J.APELLIDO1," ",J.APELLIDO2)NOMBRE_JEFE
FROM EMPLEADO E, CLIENTE C, EMPLEADO J
WHERE E.CODIGO_EMPLEADO NOT IN
(SELECT DISTINCT CODIGO_EMPLEADO_REP_VENTAS
FROM CLIENTE)
AND J.CODIGO_EMPLEADO = E.CODIGO_JEFE
ORDER BY 1